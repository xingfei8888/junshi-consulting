<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRMç³»ç»Ÿ - å¤§è¿å›å®ç®¡ç†å’¨è¯¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: #f5f7fa; }
        
        .crm-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 20px 0;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .logo span {
            color: #4fc3f7;
        }
        
        .logo p {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-menu li {
            margin-bottom: 5px;
        }
        
        .nav-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-menu a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            padding-left: 25px;
        }
        
        .nav-menu a.active {
            background: rgba(79, 195, 247, 0.2);
            border-left: 3px solid #4fc3f7;
            color: white;
        }
        
        .nav-menu i {
            font-style: normal;
            margin-right: 10px;
            font-size: 18px;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header h1 {
            color: #1a237e;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #1a237e;
            margin: 10px 0;
        }
        
        .quick-actions {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .quick-actions h3 {
            margin-bottom: 20px;
            color: #1a237e;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .action-btn {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            background: #4fc3f7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .action-btn:hover {
            background: #03a9f4;
        }
        
        .recent-activities {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
    <div class="crm-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="logo">
                <h2>å›å®<span>CRM</span></h2>
                <p>å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿ</p>
            </div>
            
            <ul class="nav-menu">
                <li><a href="crm-proper.html" class="active"><i>ğŸ“Š</i>ä»ªè¡¨æ¿</a></li>
                <li><a href="customers.html"><i>ğŸ‘¥</i>å®¢æˆ·ç®¡ç†</a></li>
                <li><a href="opportunities.html"><i>ğŸ¯</i>é”€å”®ç®¡é“</a></li>
                <li><a href="tasks.html"><i>âœ…</i>ä»»åŠ¡ç®¡ç†</a></li>
                <li><a href="reports.html"><i>ğŸ“ˆ</i>æŠ¥è¡¨åˆ†æ</a></li>
                <li><a href="index.html" target="_blank"><i>ğŸ¢</i>å…¬å¸å®˜ç½‘</a></li>
            </ul>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <h1>CRMä»ªè¡¨æ¿</h1>
                <div style="color: #666; font-size: 14px;">æ¬¢è¿ä½¿ç”¨å¤§è¿å›å®CRMç³»ç»Ÿ</div>
            </div>
            
            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div>æ€»å®¢æˆ·æ•°</div>
                    <div class="stat-number" id="totalCustomers">0</div>
                    <div style="color: #666; font-size: 14px;">æ‰€æœ‰å®¢æˆ·</div>
                </div>
                <div class="stat-card">
                    <div>é”€å”®ç®¡é“</div>
                    <div class="stat-number" id="totalOpportunities">0</div>
                    <div style="color: #666; font-size: 14px;">è¿›è¡Œä¸­å•†æœº</div>
                </div>
                <div class="stat-card">
                    <div>å¾…åŠä»»åŠ¡</div>
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div style="color: #666; font-size: 14px;">éœ€è¦å¤„ç†</div>
                </div>
                <div class="stat-card">
                    <div>é¢„è®¡æ”¶å…¥</div>
                    <div class="stat-number" id="forecastAmount">Â¥0</div>
                    <div style="color: #666; font-size: 14px;">æœ¬æœˆé¢„æµ‹</div>
                </div>
            </div>
            
            <!-- å¿«æ·æ“ä½œ -->
            <div class="quick-actions">
                <h3>å¿«æ·æ“ä½œ</h3>
                <div class="action-buttons">
                    <a href="customers.html#add" class="action-btn"><i>â•</i> æ·»åŠ æ–°å®¢æˆ·</a>
                    <a href="opportunities.html#add" class="action-btn"><i>ğŸ¯</i> åˆ›å»ºå•†æœº</a>
                    <a href="tasks.html#add" class="action-btn"><i>âœ…</i> æ–°å»ºä»»åŠ¡</a>
                    <a href="reports.html" class="action-btn"><i>ğŸ“ˆ</i> æŸ¥çœ‹æŠ¥è¡¨</a>
                </div>
            </div>
            
            <!-- æœ€è¿‘æ´»åŠ¨ -->
            <div class="recent-activities">
                <h3>æœ€è¿‘æ´»åŠ¨</h3>
                <div id="recentActivities" style="color: #666; line-height: 1.8;">
                    æš‚æ— æœ€è¿‘æ´»åŠ¨è®°å½•...
                </div>
            </div>
        </div>
    </div>
    
<script src="crm-proper-login.js"></script>
    <script>
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStats() {
            try {
                // å®¢æˆ·æ•°
                const customers = JSON.parse(localStorage.getItem('junshi_crm_customers') || '[]');
                document.getElementById('totalCustomers').textContent = customers.length;
                
                // å•†æœºæ•°
                const opportunities = JSON.parse(localStorage.getItem('junshi_crm_opportunities') || '[]');
                const activeOpportunities = opportunities.filter(o => o.stage < 7);
                document.getElementById('totalOpportunities').textContent = activeOpportunities.length;
                
                // ä»»åŠ¡æ•°
                const tasks = JSON.parse(localStorage.getItem('junshi_crm_tasks') || '[]');
                const pendingTasks = tasks.filter(t => t.status !== 'completed');
                document.getElementById('pendingTasks').textContent = pendingTasks.length;
                
                // é¢„è®¡æ”¶å…¥
                const forecast = opportunities
                    .filter(o => o.probability && o.probability > 50)
                    .reduce((sum, o) => sum + (o.amount || 0) * (o.probability || 0) / 100, 0);
                document.getElementById('forecastAmount').textContent = 'Â¥' + forecast.toLocaleString(undefined, {maximumFractionDigits: 0});
                
                // æœ€è¿‘æ´»åŠ¨
                const recent = [];
                
                // æœ€æ–°å®¢æˆ·
                if (customers.length > 0) {
                    const latestCustomer = customers[customers.length - 1];
                    recent.push(`ğŸ‘¥ æ–°å¢å®¢æˆ·: ${latestCustomer.name} (${new Date(latestCustomer.createdAt).toLocaleDateString('zh-CN')})`);
                }
                
                // æœ€æ–°å•†æœº
                if (opportunities.length > 0) {
                    const latestOpp = opportunities[opportunities.length - 1];
                    recent.push(`ğŸ¯ æ–°å¢å•†æœº: ${latestOpp.name} (Â¥${(latestOpp.amount || 0).toLocaleString()})`);
                }
                
                // æœ€æ–°ä»»åŠ¡
                if (tasks.length > 0) {
                    const latestTask = tasks[tasks.length - 1];
                    recent.push(`âœ… æ–°å»ºä»»åŠ¡: ${latestTask.title}`);
                }
                
                if (recent.length > 0) {
                    document.getElementById('recentActivities').innerHTML = 
                        recent.map(item => `<div>â€¢ ${item}</div>`).join('');
                }
                
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', loadStats);
        
        // æ·»åŠ ç®€å•çš„å¯¼èˆªç‚¹å‡»æ—¥å¿—
        console.log('CRMä»ªè¡¨æ¿åŠ è½½å®Œæˆï¼Œå¯¼èˆªå·²å¯ç”¨');
        console.log('æ‰€æœ‰å¯¼èˆªé“¾æ¥:', document.querySelectorAll('.nav-menu a').length);
    </script>
</body>
</html>