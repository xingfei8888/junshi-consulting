<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ·ç®¡ç† - å›å®CRM</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; margin: 0; padding: 0; background: #f8f9fa; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .crm-header { 
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%); 
            color: white; padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .logo { font-size: 24px; font-weight: bold; }
        .logo span { color: #4fc3f7; }
        .nav { display: flex; gap: 20px; }
        .nav a { color: white; text-decoration: none; padding: 5px 0; position: relative; }
        .nav a:hover::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px; background: #4fc3f7; }
        .btn { 
            background: #4fc3f7; color: white; padding: 8px 16px; 
            border: none; border-radius: 4px; cursor: pointer;
            font-size: 14px; transition: background 0.3s;
        }
        .btn:hover { background: #03a9f4; }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #219653; }
        .btn-warning { background: #f39c12; }
        .btn-warning:hover { background: #e67e22; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .table { width: 100%; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .table th { background: #f1f8ff; padding: 15px; text-align: left; font-weight: 600; color: #2c3e50; }
        .table td { padding: 12px 15px; border-bottom: 1px solid #eee; }
        .tag { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .tag-new { background: #d4edda; color: #155724; }
        .tag-contacted { background: #d1ecf1; color: #0c5460; }
        .tag-followup { background: #fff3cd; color: #856404; }
        .tag-deal { background: #d4edda; color: #155724; }
        .tag-lost { background: #f8d7da; color: #721c24; }
        .search-box { 
            padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; 
            width: 300px; font-size: 14px;
            transition: border-color 0.3s;
        }
        .search-box:focus { outline: none; border-color: #4fc3f7; box-shadow: 0 0 0 2px rgba(79, 195, 247, 0.2); }
    </style>
</head>
<body>
    <header class="crm-header">
        <div class="logo">å›å®<span>CRM</span></div>
        <nav class="nav">
            <a href="crm.html">ä»ªè¡¨æ¿</a>
            <a href="customers.html" style="color: #4fc3f7;">å®¢æˆ·ç®¡ç†</a>
            <a href="opportunities.html">é”€å”®ç®¡é“</a>
            <a href="reports.html">æŠ¥è¡¨åˆ†æ</a>
            <a href="index.html">è¿”å›å®˜ç½‘</a>
        </nav>
    </header>
    
    <div class="container">
        <h1 style="color: #2c3e50; margin-bottom: 20px; font-size: 28px;">å®¢æˆ·ç®¡ç†</h1>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <button class="btn btn-success" onclick="showAddForm()" style="display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 18px;">+</span>
                æ–°å¢å®¢æˆ·
            </button>
            <div>
                <input type="text" id="searchInput" class="search-box" placeholder="æœç´¢å®¢æˆ·åç§°ã€è”ç³»äººã€ç”µè¯...">
            </div>
        </div>
        
        <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                <div>
                    <span style="color: #666; font-size: 14px;">æ€»å®¢æˆ·æ•°ï¼š</span>
                    <span style="font-size: 24px; font-weight: bold; color: #2c3e50;" id="totalCustomers">0</span>
                </div>
                <div>
                    <span style="color: #666; font-size: 14px;">æ–°å®¢æˆ·ï¼š</span>
                    <span style="font-size: 24px; font-weight: bold; color: #27ae60;" id="newCustomers">0</span>
                </div>
                <div>
                    <span style="color: #666; font-size: 14px;">å·²è”ç³»ï¼š</span>
                    <span style="font-size: 24px; font-weight: bold; color: #3498db;" id="contactedCustomers">0</span>
                </div>
                <div>
                    <span style="color: #666; font-size: 14px;">å·²æˆäº¤ï¼š</span>
                    <span style="font-size: 24px; font-weight: bold; color: #9b59b6;" id="closedCustomers">0</span>
                </div>
            </div>
        </div>
        
        <table class="table">
            <thead>
                <tr>
                    <th>å®¢æˆ·åç§°</th>
                    <th>è”ç³»äºº</th>
                    <th>ç”µè¯</th>
                    <th>é‚®ç®±</th>
                    <th>æ¥æº</th>
                    <th>çŠ¶æ€</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="customerTableBody">
                <!-- åŠ¨æ€åŠ è½½ -->
            </tbody>
        </table>
        
        <div style="text-align: center; margin-top: 20px; color: #666; padding: 20px;" id="loadingText">
            æ­£åœ¨åŠ è½½å®¢æˆ·æ•°æ®...
        </div>
        
        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="color: #2c3e50; margin-bottom: 15px;">æ•°æ®ç®¡ç†</h3>
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="exportData()" style="background: #34495e;">
                    å¯¼å‡ºæ•°æ®
                </button>
                <button class="btn" onclick="importData()" style="background: #7f8c8d;">
                    å¯¼å…¥æ•°æ®
                </button>
                <button class="btn btn-danger" onclick="clearAllData()">
                    æ¸…ç©ºæ•°æ®
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // å®¢æˆ·æ•°æ®ç®¡ç†
        class CustomerManager {
            constructor() {
                this.storageKey = 'junshi_crm_customers';
                // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
                this.initializeSampleData();
            }
            
            initializeSampleData() {
                const existingData = localStorage.getItem(this.storageKey);
                if (!existingData) {
                    const sampleCustomers = [
                        {
                            id: 1,
                            name: 'å¤§è¿æŸå›½ä¼',
                            contactPerson: 'ç‹ç»ç†',
                            phone: '0411-12345678',
                            email: 'wang@example.com',
                            source: 'ç½‘ç«™å’¨è¯¢',
                            status: 'contacted',
                            notes: 'éœ€è¦ç»„ç»‡æ¶æ„ä¼˜åŒ–æœåŠ¡',
                            createdAt: '2026-01-15T10:30:00Z'
                        },
                        {
                            id: 2,
                            name: 'æŸåˆ¶é€ ä¼ä¸š',
                            contactPerson: 'ææ€»',
                            phone: '0411-87654321',
                            email: 'li@example.com',
                            source: 'å®¢æˆ·æ¨è',
                            status: 'followup',
                            notes: 'æµç¨‹ä¼˜åŒ–é¡¹ç›®è·Ÿè¿›ä¸­',
                            createdAt: '2026-01-20T14:20:00Z'
                        },
                        {
                            id: 3,
                            name: 'ç§‘æŠ€å…¬å¸A',
                            contactPerson: 'å¼ æ€»ç›‘',
                            phone: '0411-55556666',
                            email: 'zhang@example.com',
                            source: 'è¡Œä¸šæ´»åŠ¨',
                            status: 'new',
                            notes: 'æ•°å­—åŒ–è½¬å‹å’¨è¯¢éœ€æ±‚',
                            createdAt: '2026-02-01T09:15:00Z'
                        }
                    ];
                    localStorage.setItem(this.storageKey, JSON.stringify(sampleCustomers));
                }
            }
            
            getCustomers() {
                const data = localStorage.getItem(this.storageKey);
                return data ? JSON.parse(data) : [];
            }
            
            saveCustomers(customers) {
                localStorage.setItem(this.storageKey, JSON.stringify(customers));
            }
            
            addCustomer(customer) {
                const customers = this.getCustomers();
                customer.id = Date.now();
                customer.createdAt = new Date().toISOString();
                customers.push(customer);
                this.saveCustomers(customers);
                return customer;
            }
            
            updateCustomer(id, updates) {
                const customers = this.getCustomers();
                const index = customers.findIndex(c => c.id === id);
                if (index !== -1) {
                    customers[index] = {...customers[index], ...updates};
                    this.saveCustomers(customers);
                    return true;
                }
                return false;
            }
            
            deleteCustomer(id) {
                const customers = this.getCustomers();
                const filtered = customers.filter(c => c.id !== id);
                this.saveCustomers(filtered);
                return filtered.length !== customers.length;
            }
        }
        
        const customerManager = new CustomerManager();
        
        // æ¸²æŸ“å®¢æˆ·è¡¨æ ¼
        function renderCustomerTable() {
            const customers = customerManager.getCustomers();
            const tbody = document.getElementById('customerTableBody');
            const loadingText = document.getElementById('loadingText');
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats(customers);
            
            if (customers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                            ğŸ“Š æš‚æ— å®¢æˆ·æ•°æ®ï¼Œç‚¹å‡»"æ–°å¢å®¢æˆ·"æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªå®¢æˆ·
                        </td>
                    </tr>
                `;
                loadingText.style.display = 'none';
                return;
            }
            
            // æŒ‰åˆ›å»ºæ—¶é—´æ’åº
            customers.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            tbody.innerHTML = customers.map(customer => {
                const date = new Date(customer.createdAt);
                const formattedDate = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                
                let statusClass = '';
                let statusText = '';
                switch(customer.status) {
                    case 'new': 
                        statusClass = 'tag-new'; 
                        statusText = 'æ–°å®¢æˆ·'; 
                        break;
                    case 'contacted': 
                        statusClass = 'tag-contacted'; 
                        statusText = 'å·²è”ç³»'; 
                        break;
                    case 'followup': 
                        statusClass = 'tag-followup'; 
                        statusText = 'è·Ÿè¿›ä¸­'; 
                        break;
                    case 'deal': 
                        statusClass = 'tag-deal'; 
                        statusText = 'å·²æˆäº¤'; 
                        break;
                    case 'lost': 
                        statusClass = 'tag-lost'; 
                        statusText = 'å·²æµå¤±'; 
                        break;
                }
                
                return `
                    <tr>
                        <td style="font-weight: 500;">${customer.name || 'æœªå‘½å'}</td>
                        <td>${customer.contactPerson || '--'}</td>
                        <td>${customer.phone || '--'}</td>
                        <td>${customer.email || '--'}</td>
                        <td>${customer.source || '--'}</td>
                        <td><span class="tag ${statusClass}">${statusText}</span></td>
                        <td>${formattedDate}</td>
                        <td>
                            <button class="btn" onclick="viewCustomer(${customer.id})" style="margin-right: 5px;">æŸ¥çœ‹</button>
                            <button class="btn btn-warning" onclick="editCustomer(${customer.id})" style="margin-right: 5px;">ç¼–è¾‘</button>
                            <button class="btn btn-danger" onclick="deleteCustomer(${customer.id})">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            loadingText.style.display = 'none';
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats(customers) {
            const total = customers.length;
            const newCount = customers.filter(c => c.status === 'new').length;
            const contactedCount = customers.filter(c => c.status === 'contacted').length;
            const closedCount = customers.filter(c => c.status === 'deal').length;
            
            document.getElementById('totalCustomers').textContent = total;
            document.getElementById('newCustomers').textContent = newCount;
            document.getElementById('contactedCustomers').textContent = contactedCount;
            document.getElementById('closedCustomers').textContent = closedCount;
        }
        
        // æ˜¾ç¤ºæ·»åŠ è¡¨å•
        function showAddForm() {
            const name = prompt('è¯·è¾“å…¥å®¢æˆ·åç§°ï¼š');
            if (!name) return;
            
            const customer = {
                name: name,
                contactPerson: prompt('è¯·è¾“å…¥è”ç³»äººï¼š') || '',
                phone: prompt('è¯·è¾“å…¥è”ç³»ç”µè¯ï¼š') || '',
                email: prompt('è¯·è¾“å…¥é‚®ç®±åœ°å€ï¼š') || '',
                source: prompt('å®¢æˆ·æ¥æºï¼ˆç½‘ç«™/æ¨è/æ´»åŠ¨ç­‰ï¼‰ï¼š') || 'å…¶ä»–',
                status: 'new',
                notes: prompt('å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ï¼š') || ''
            };
            
            customerManager.addCustomer(customer);
            renderCustomerTable();
            alert('å®¢æˆ·æ·»åŠ æˆåŠŸï¼');
        }
        
        // æŸ¥çœ‹å®¢æˆ·
        function viewCustomer(id) {
            const customers = customerManager.getCustomers();
            const customer = customers.find(c => c.id === id);
            if (customer) {
                const date = new Date(customer.createdAt);
                const formattedDate = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                alert(`ğŸ“‹ å®¢æˆ·è¯¦æƒ…

ğŸ¢ å®¢æˆ·åç§°ï¼š${customer.name}
ğŸ‘¤ è”ç³»äººï¼š${customer.contactPerson || '--'}
ğŸ“ ç”µè¯ï¼š${customer.phone || '--'}
ğŸ“§ é‚®ç®±ï¼š${customer.email || '--'}
ğŸ“ æ¥æºï¼š${customer.source || '--'}
ğŸ·ï¸ çŠ¶æ€ï¼š${customer.status}
ğŸ“… åˆ›å»ºæ—¶é—´ï¼š${formattedDate}
ğŸ“ å¤‡æ³¨ï¼š${customer.notes || 'æ— '}`);
            }
        }
        
        // ç¼–è¾‘å®¢æˆ·
        function editCustomer(id) {
            const customers = customerManager.getCustomers();
            const customer = customers.find(c => c.id === id);
            if (customer) {
                const updates = {
                    name: prompt('ä¿®æ”¹å®¢æˆ·åç§°ï¼š', customer.name) || customer.name,
                    contactPerson: prompt('ä¿®æ”¹è”ç³»äººï¼š', customer.contactPerson) || customer.contactPerson,
                    phone: prompt('ä¿®æ”¹ç”µè¯ï¼š', customer.phone) || customer.phone,
                    email: prompt('ä¿®æ”¹é‚®ç®±ï¼š', customer.email) || customer.email,
                    source: prompt('ä¿®æ”¹æ¥æºï¼š', customer.source) || customer.source,
                    status: prompt('ä¿®æ”¹çŠ¶æ€ï¼ˆnew/contacted/followup/deal/lostï¼‰ï¼š', customer.status) || customer.status,
                    notes: prompt('ä¿®æ”¹å¤‡æ³¨ï¼š', customer.notes) || customer.notes
                };
                
                customerManager.updateCustomer(id, updates);
                renderCustomerTable();
                alert('å®¢æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸï¼');
            }
        }
        
        // åˆ é™¤å®¢æˆ·
        function deleteCustomer(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®¢æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                customerManager.deleteCustomer(id);
                renderCustomerTable();
                alert('å®¢æˆ·åˆ é™¤æˆåŠŸï¼');
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const customers = customerManager.getCustomers();
            const data = {
                customers: customers,
                exportedAt: new Date().toISOString(),
                total: customers.length
            };
            
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `junshi-crm-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert(`æ•°æ®å¯¼å‡ºæˆåŠŸï¼å…±å¯¼å‡º ${customers.length} ä¸ªå®¢æˆ·æ•°æ®ã€‚`);
        }
        
        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.customers && Array.isArray(data.customers)) {
                            localStorage.setItem('junshi_crm_customers', JSON.stringify(data.customers));
                            renderCustomerTable();
                            alert(`æ•°æ®å¯¼å…¥æˆåŠŸï¼å…±å¯¼å…¥ ${data.customers.length} ä¸ªå®¢æˆ·æ•°æ®ã€‚`);
                        } else {
                            alert('æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„å¤‡ä»½æ–‡ä»¶ã€‚');
                        }
                    } catch (error) {
                        alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // æ¸…ç©ºæ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å®¢æˆ·æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('junshi_crm_customers');
                customerManager.initializeSampleData(); // é‡æ–°åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
                renderCustomerTable();
                alert('æ•°æ®å·²æ¸…ç©ºï¼Œå·²æ¢å¤ç¤ºä¾‹æ•°æ®ã€‚');
            }
        }
        
        // æœç´¢åŠŸèƒ½
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#customerTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
        
        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            renderCustomerTable();
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    showAddForm();
                }
                if (e.key === 'Escape') {
                    document.getElementById('searchInput').value = '';
                    renderCustomerTable();
                }
            });
            
            // æœç´¢æ¡†èšç„¦
            document.getElementById('searchInput').addEventListener('focus', function() {
                this.select();
            });
        });
    </script>
    <!-- CRMå’¨è¯¢é€šçŸ¥ -->
    <script src="crm-notification.js"></script>
</body>
</html>